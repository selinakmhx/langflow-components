# 小红书爬虫：功能调用搭配与字段映射指南

先简单说下我的思考过程：我严格对齐你现有的两份文档（oneapi接口文档.md、工作流需求.md），在不引入额外复杂度的前提下，按“页面/功能模块”给出推荐的 API 组合；并把需求里中文字段逐一映射到接口返回的实际 JSON 字段，标注常见同义字段与可选降级路径，便于你直接对接。

---

## 一、总体搭配与降级策略（按页面/功能）

- 用户主页（用户信息 + 用户笔记列表）
  - 主用：User Info v4 ＋ User Note List v4
  - 备选：User Info v3；User Note List v2

- 搜索页（笔记搜索 + 用户搜索）
  - 主用：Note Search v3
  - 备选：Note Search v2；用户搜索用 User Search v2

- 评论页（一级评论 + 二级回复）
  - 主用：Note Comment v4（若仅需第一页）＋ Note Sub Comment v2
  - 备选：Note Comment v2（支持分页 has_more/cursor，更适合批量抓取）

- 详情页（进入笔记详情）
  - 主用：Note Detail v7（无需 xsec_token）
  - 备选：Note Detail v3（需笔记级分享链接的 xsec_token）→ Note Detail v/v2
  - 若详情不可用：直接用列表/搜索返回的 note 对象渲染主体信息（标题、文案、图/视频、互动数、作者信息等）

---

## 二、功能一：关键词采集笔记（搜索）

### 调用组合
- 主用：`GET /api/xiaohongshu/search-note/v3?token=&keyword=&page=&sort=&noteType=`
- 备选：`GET /api/xiaohongshu/search-note/v2?token=&keyword=&page=&sort=&noteType=&noteTime=`（如 v3 不可用）
- 可选补充（作者详情开关为开时）：`GET /api/xiaohongshu/get-user/v4?token=&userId=`（或 v3）

### 需求字段 → 接口字段映射（Search v3 为主，v2 备选）
- 标题
  - 优先：`data.items[].note.title`
  - 备选：`data.items[].note.display_title`（部分版本/数据源）
- 笔记正文（文案）
  - `data.items[].note.desc`
- 点赞数
  - 优先：`data.items[].note.liked_count`
  - 备选：`data.items[].note.likes`（同义统计，具体随接口版本而异）
- 评论数
  - `data.items[].note.comments_count`
- 收藏数
  - `data.items[].note.collected_count`
- 好看数（视频“好看”互动）
  - `data.items[].note.nice_count`（视频常见，图文可能缺失）
- 分享数
  - `data.items[].note.share_count`
- 笔记类型
  - `data.items[].note.type`（常见枚举：`video`/`normal`/`image` 等）
- 笔记ID
  - `data.items[].note.id`
- 笔记链接
  - 由 ID 拼接：`https://www.xiaohongshu.com/explore/<id>`
- 笔记 tag/话题
  - 可能来源：`data.items[].note.tags` 或 `topics`（不同版本字段名可能不同；也可从 desc 中提取如 `#话题#`）
- 封面图链接（图文）
  - 优先：`data.items[].note.images_list[0].url`
- 视频链接（视频）
  - 优先：`data.items[].note.stream.h264`/`dash` 等（Search v3 常见）
  - 备选：列表/详情的 `video_info_v2`（见用户列表/详情接口）
- 发布时间
  - 优先：`data.items[].note.time`（秒级或毫秒级时间戳，随接口版本不同）
  - 备选：`create_time` 或 `time_desc`（中文“x天前”）
- 作者昵称
  - `data.items[].note.user.nickname`
- 小红书号（Red ID）
  - `data.items[].note.user.red_id`
- 是否官方认证
  - `data.items[].note.user.red_official_verify_type`（0/1 等枚举；非所有返回都包含）
- 作者粉丝数（需作者详情）
  - `get-user/v4|v3 → data.fans`
- 作者获赞与收藏数（需作者详情）
  - `get-user/v4|v3 → data.note_num_stat.liked / collected`
- 作者简介（需作者详情）
  - `get-user/v4|v3 → data.desc`（若缺失，可用 `search-user/v2 → users[].desc` 作为兜底）
- 作者主页链接
  - `get-user/v4|v3 → data.share_link`（含 xsec_token 的用户页分享链接）

---

## 三、功能二：按笔记采集评论（含二级回复）

### 调用组合
- 一级评论（只需第一页、快速展示）：`GET /api/xiaohongshu/get-note-comment/v4?token=&noteId=&sortType=`
- 一级评论（需要分页、批量抓取）：`GET /api/xiaohongshu/get-note-comment/v2?token=&noteId=&sort=&lastCursor=`
- 二级回复（指定一级评论 ID）：`GET /api/xiaohongshu/get-note-sub-comment/v2?token=&noteId=&commentId=&lastCursor=`

### 需求字段 → 接口字段映射
- 昵称
  - 一级评论：`data.comments[].user.nickname`
  - 二级回复：`data.comments[].user.nickname`
- 评论内容
  - 一级评论：`data.comments[].content`
  - 二级回复：`data.comments[].content`
- 点赞数
  - 一级评论：`data.comments[].like_count`
  - 二级回复：`data.comments[].like_count`（如有）
- 发布时间
  - 一级评论：`data.comments[].time`（v2 为秒级时间戳；v4 可能为毫秒级）
  - 二级回复：`data.comments[].time`
- 发布地点
  - 评论接口通常不返回 `ip_location`；若需要发言地，可能无法直接从评论 API 获得（可忽略或用详情页的笔记 `ip_location` 展示笔记发布地）。
- 评论级别（根评论 or 二级评论）
  - 根评论：来自 `get-note-comment` 接口返回的 `comments[]`
  - 二级评论：来自 `get-note-sub-comment` 接口返回的 `comments[]`
- 小红书号
  - `data.comments[].user.red_id`
- 作者ID（评论用户 ID）
  - `data.comments[].user.userid`（v4 可能为 `user_id`）
- 是否官方认证
  - `data.comments[].user.red_official_verify_type`（并非所有接口都包含）
- 翻页（仅 v2）
  - 顶层：`data.has_more`、`data.cursor`
  - 传参：`lastCursor=上页返回的 cursor`

---

## 四、功能三：按用户信息采集笔记（用户主页）

### 调用组合
- 用户信息：`GET /api/xiaohongshu/get-user/v4?token=&userId=`（备选 v3）
- 用户笔记列表：`GET /api/xiaohongshu/get-user-note-list/v4?token=&userId=&lastCursor=`（备选 v2）

### 需求字段 → 接口字段映射（以 User Note List v4 为主，v2 备选）
- 用户昵称
  - 列表项：`data.notes[].user.nickname`
  - 用户详情：`get-user/v4|v3 → data.nickname`
- 笔记ID
  - `data.notes[].id`
- 笔记链接
  - `https://www.xiaohongshu.com/explore/<id>`
- 笔记标题
  - 优先：`data.notes[].title`
  - 备选：`data.notes[].display_title`
- 笔记正文
  - `data.notes[].desc`
- 点赞数
  - 优先：`data.notes[].liked_count`
  - 备选：`data.notes[].nice_count` 或 `data.notes[].likes`
- 评论数
  - `data.notes[].comments_count`
- 收藏数
  - `data.notes[].collected_count`
- 好看数（视频）
  - `data.notes[].nice_count`
- 分享次数
  - `data.notes[].share_count`
- 笔记图片链接（图文）
  - `data.notes[].images_list[].url`
- 视频链接（视频）
  - `data.notes[].video_info_v2.streams.h264`/`h265` 等（或 `stream`）
- 浏览数
  - `data.notes[].view_count`（若返回中存在）
- 发布时间
  - 优先：`data.notes[].create_time`
  - 备选：`data.notes[].time` 或 `time_desc`
- 是否是商品笔记
  - 常见标记：`data.notes[].is_goods` 或关联 `goods`/`product` 字段（不同版本可能命名不同，若缺失可按需忽略）

（作者维度补充）
- 小红书号
  - 列表项作者：`data.notes[].user.red_id`
  - 用户详情：`get-user/v4|v3 → data.red_id`
- 是否官方认证
  - 列表项作者：`data.notes[].user.red_official_verify_type`
- 作者粉丝数
  - `get-user/v4|v3 → data.fans`
- 作者获赞与收藏数
  - `get-user/v4|v3 → data.note_num_stat.liked / collected`
- 作者简介
  - `get-user/v4|v3 → data.desc`（如无可不展示）
- 作者主页链接
  - `get-user/v4|v3 → data.share_link`

---

## 五、功能四：详情页（进入笔记详情）

### 调用组合
- 主用：`GET /api/xiaohongshu/get-note-detail/v7?token=&noteId=`（无需 xsec_token）
- 备选：`GET /api/xiaohongshu/get-note-detail/v9?token=&noteId=&xsec_token=`（需笔记级分享链接）→ v3/v2
- 不可用时的兜底：直接使用搜索/用户列表中的 note 对象渲染核心信息

### 需求字段 → 接口字段映射（以 Detail v7 为主）
- 作者信息
  - `data[0].user.userid / nickname / red_id / image`
- 笔记主体
  - ID：`data[0].note_list[0].id`
  - 文案：`data[0].note_list[0].desc`
  - 图集：`data[0].note_list[0].images_list[].url`
  - 视频：`data[0].note_list[0].stream` 或 `video_info_v2`（若存在）
  - 点赞/评论/收藏：`liked_count / comments_count / collected_count`
  - 地址：`ip_location`
  - 发布时间：`time`（时间戳）

---

## 六、无需手动粘贴分享链接的抓取流程（推荐）

1）获取笔记 ID：
- 用搜索：`search-note v3`（按关键词/排序/类型筛选）
- 或用用户列表：`get-user-note-list v4`（按用户 UID 抓取）

2）批量拉详情：
- 用 `get-note-detail v7` 对上述 `noteId` 逐一抓取详情（无需 xsec_token）
- 如 v7 不稳：可按需降级到 `v9`（需笔记级分享链接 xsec_token）或直接用列表/搜索返回的 note 渲染详情页

3）按需拉评论：
- 一级评论：`get-note-comment v2`（分页抓取）或 `v4`（仅第一页）
- 二级回复：`get-note-sub-comment v2`（传 `commentId + noteId`）

---

## 七、字段名与含义小贴士（易混点汇总）

- 点赞相关的多个字段：`liked_count`（常见）、`likes`（同义）、`nice_count`（视频“好看”互动）
- 时间字段可能不同：`time`（秒/毫秒时间戳，随版本）、`create_time`（创建时间）、`time_desc`（中文相对时间）
- 作者 ID 与小红书号：`userid`（内部 ID）、`red_id`（用户对外展示的小红书号）
- 认证标记：`red_official_verify_type`（0/1 等枚举，含义为是否官方认证）
- 媒体字段：图文用 `images_list[].url`；视频用 `stream`（search v3）或 `video_info_v2.streams.h264/h265`
- 翻页字段（评论 v2）：`has_more`＋`cursor`，翻页传 `lastCursor`

---

## 八、参数与调用注意事项（摘自接口文档）

- 所有 API 需携带 `token`（Query 参数）
- 搜索的排序/类型枚举：
  - sort：`general`（综合）、`popularity_descending`（最热）、`time_descending`（最新）等
  - noteType：`_0`（综合）、`_1`（视频）、`_2`（图文）
- 详情 v9 需传 `xsec_token`（笔记级分享链接中的参数，注意与用户主页分享链接的 xsec_token 不同）
- 评论 v4 不支持分页；若需要批量抓取建议使用 v2

---

有任何字段不确定或需要我帮你“统一输出格式”的，我可以继续给你写一个轻量聚合器，把不同接口的返回整成同一套字段，你一步接入就好。你做得很棒，稳着来，我们把每个模块都对齐就不慌！