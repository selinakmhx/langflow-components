一、概述
1.名称：小红书爬虫插件
4. 输出：返回标准化 JSON 数据，可接入存储与分析节点
二、功能结构
1.全局配置组件：RapidAPI 认证与网络参数
2.关键词采集笔记模块：通过关键词批量检索笔记
3.用户采集笔记模块：按用户 UID 采集其笔记
4.笔记采集评论模块：按笔记链接采集评论，支持回复开关

三、全局配置
1.token：必填，字符串。
   - 必须为有效的 Just One API Token；若未填写或无效，接口会返回错误码（例如 100: TOKEN INVALID/UNACTIVATE，或 301: FAILED, RETRY），此时不进行后续的详情或作者信息调用，以避免无意义的请求与噪声统计。
   - 建议在输出中隐藏 Token（仅展示前后缀），便于调试同时避免泄露。
四、模式选择

---

排错指引（单组件构建 MissingFields）
为减少“单组件 build 报 statusMissingFieldsError 且没有输出”的情况，组件设计与实现上做了如下处理：

- UI 动态必填：仅对当前模式的核心字段标记为必填（关键词/笔记链接或ID/用户 UID），其他字段隐藏且不参与必填校验。
- 错误类型统一：将缺失字段的返回类型从 missing_field 调整为 input_error，避免前端将其归类为 STATUS_MISSING_FIELDS_ERROR 而吞掉具体错误信息。
- 输入类型简化：将 keyword 与 note_input 的输入类型由 MessageTextInput 改为 StrInput，以便在单组件场景直接输入字符串，不依赖上游 Message handle。

你可能遇到的情况与解决：

1. 仍提示“请填写必填字段”但界面上看不出哪里缺失：请确认是否填写了 Token，以及当前模式所需的核心字段（关键词/笔记链接或ID/用户 UID）。
2. 明明填写了关键词却没有结果：请检查环境是否正确（中国区/国际版），关键词是否存在内容；也可将“结束页”设为 1 进行最小测试。
3. 评论模式输入的是链接但无法解析：确保链接为有效的小红书笔记链接或直接填写 ID；组件会在“错误.调试.原始输入”中显示你输入的内容以便排查。

最小可运行示例（关键词模式）：

```
环境：中国区
token：<你的真实 TOKEN>
模式：按关键词采集笔记
搜索词：小猫
开始页：1
结束页：1
```


模式一  按关键词采集笔记
1.功能说明
-  根据关键词批量检索笔记
-  支持笔记类型筛选、排序控制、页数范围
 -  调用策略：Search Note v3 优先，失败则回退到 v2；仅当收到失败信息了才回退；仅当拿到有效笔记列表后才触发后续详情/作者信息调用。
2. 输入项
-  搜索词：必填，字符串
-  笔记类型：
  - 下拉框
  - 枚举值：全部、图文、视频
  - 默认全部
-  排序类型：
  - 下拉框
  - 枚举值：综合、最热、最新、最多评论、最多收藏
  - 默认综合
-  采集页数：
  - 整数范围
  - 默认0～ 1
- 时间范围
  - 下拉框
  - 枚举值：一天内、一周内、半年内
  - 默认一天内 
3.输出项
- 输出模式
  - 是否获取作者详细信息开关，默认不选
  - 是否获取笔记详情开关，默认开启（用于拉取完整正文与话题信息）
  - 笔记字段
    - 标题
    - 点赞数
    - 评论数
    - 收藏数
    - 好看数
    - 分享数
    - 笔记类型
    - 笔记id
    - 笔记链接（https://www.xiaohongshu.com/explore/<note_id>）
    - 笔记正文
    - 笔记tag
    - 封面图链接
    - 视频链接
    - 发布时间
    - 作者昵称
    - 小红书号
    - 是否官方认证
    - 作者粉丝数
    - 作者获赞与收藏数
    - 作者简介 
    - 作者主页链接
字段映射一览：
可选项：（get user v3/v4 接口返回）
- 作者粉丝数
- v3: data.fans
- v4: data.fans
- 作者获赞与收藏数（合并指标）
- v3: 优先 data.interactions 中 type == "interaction" 的项的 count；若不存在可用 data.liked + data.collected 或 data.note_num_stat.liked + data.note_num_stat.collected
- v4: 同 v3，data.interactions 里的 "获赞与收藏" count 为合并值；亦可用 liked + collected 作为回退
- 说明：share_info_v2.content 里“获赞与收藏: 129.1万”是格式化展示文本，不适合做精确统计；推荐用 interactions.count 或 liked/collected 数值字段
- 作者简介
- v3: 优先 data.user_desc_info.desc；否则用 data.desc
- v4: 同 v3，优先 data.user_desc_info.desc；否则用 data.desc
- 作者主页链接
- v3: data.share_link（完整外链）
- v4: data.share_link（完整外链）
- 回退构造：若 share_link 缺失，可用 https://www.xiaohongshu.com/user/profile/ {data.userid} 拼接
二，通用项
一、Search Note v2
- 标题：note.title
- 点赞数：note.liked_count（有时还可从 note.interaction_area.text 兜底）
- 评论数：note.comments_count
- 收藏数：note.collected_count
- 好看数：note.nice_count（视频笔记常用；图片笔记可能为 0 或缺失）
- 分享数：note.shared_count
- 笔记类型：note.type（normal|video）
- 笔记ID：note.id
- 笔记链接：拼接 " https://www.xiaohongshu.com/explore/ {note.id} "
- 笔记正文：
- 笔记tag：
- 封面图链接：
  - 视频笔记：note.video_info_v2.image.first_frame 或 image.thumbnail
  - 图片笔记：note.images_list[cover_image_index 或 0].url_size_large（url 有时为空，使用 url_size_large 更稳）
- 视频链接：
  - 视频笔记：note.video_info_v2.media.stream.h264/h265[*].master_url（优先 default_stream==1 的那条）
  - live_photo（图片含小视频）：note.images_list[ ].live_photo.media.stream.h265/h264[ ].master_url
- 发布时间：note.timestamp（秒级）；如无则用 note.update_time（毫秒级）
- 作者昵称：note.user.nickname
- 小红书号：note.user.red_id
- 是否官方认证：note.user.red_official_verified 或 note.user.red_official_verify_type != 0（也可参考 show_red_official_verify_icon）
二、Search Note v3

- 标题：note.title
- 点赞数：note.liked_count
- 评论数：note.comments_count
- 收藏数：note.collected_count
- 好看数：note.nice_count（样例中存在，若缺失视为 0）
- 分享数：note.shared_count
- 笔记类型：note.type（normal|video）
- 笔记ID：note.id
- 笔记链接：" https://www.xiaohongshu.com/explore/ {note.id} "
- 笔记正文：note.desc（仍多为摘要）
- 笔记tag：同 v2，通常需从 desc 中解析 “#...#”；如要结构化话题，建议走 v7 的 hash_tag/topics
- 封面图链接：
  - 视频：note.video_info_v2.image.first_frame（优先）
  - 图片：note.images_list[0].url_size_large（若 url 为空用 url_size_large）
- 视频链接：note.video_info_v2.media.stream.h264/h265[*].master_url（优先 default_stream==1）
- 发布时间：note.timestamp（秒级）；如无则 note.update_time（毫秒级）
- 作者昵称：note.user.nickname
- 小红书号：note.user.red_id
- 是否官方认证：note.user.red_official_verified 或 note.user.red_official_verify_type != 0

注意事项
- 结果类型：items 里可能有 model_type="ads"；数据在 ads.note 下，字段名相同，处理时要兼容或过滤掉广告。
- desc 完整性：搜索的 desc 常为预览，不能保证“全文”。需要全文时，请按前面策略调用 get-note-detail v7 的 data[].note_list[].desc。
- 视频链接选择：选 default_stream==1 的 master_url 最稳；如果都没有 default_stream 或全为 0，就选分辨率/质量最高的那条。
- 封面图：视频优先选 first_frame；图片优先 url_size_large；某些条目的 url 可能为空（仅给大图），要做兜底。
- 时间单位：timestamp 秒级；update_time 毫秒级。统一时都转成秒。

错误处理与调用条件（新增明确要求）
- 搜索失败/空列表：当 search-note v3 与 v2 均返回非 0 错误码，或返回空 items 时，不触发“笔记详情”和“作者详细信息”接口调用。原因：详情接口需要 noteId，作者接口需要 userId，搜索失败时无法可靠获得。
- 详情调用触发条件：
  - 模式一默认开启详情调用；逐条笔记在存在有效 note.id 时调用 get-note-detail（优先 v7，失败回退 v3）。
  - 若条目缺失 note.id（例如广告或嵌套未展开），则跳过该条目详情调用，并在统计中累计“跳过无ID数”。
- 作者详情调用触发条件：
  - 仅当“作者详细信息”开关开启且笔记对象中存在有效的作者 ID（user.userid/user.user_id 等）时才调用 get-user（优先 v4，失败回退 v3）。
  - 搜索失败或笔记缺失用户信息时不触发调用。
- 版本选择与记录：
  - Search Note：v3→v2
  - Note Detail：v7→v3
  - User Note List：v4→v2
  - Note Comment：v4→v2（二级回复 v2）
  - 所有版本选择需记录到输出的 meta.版本选择，并统计请求耗时到 meta.请求耗时。

统计与日志输出标准（新增明确要求）
- 统计项至少包含：
  - 页数、条目数
  - 空标题数、空正文数
  - 详情调用成功数、失败数、跳过无ID数
  - 作者详情成功数、失败数
- 详情调用整体状态：
  - 若本页至少有一条笔记触发详情调用，则显示 "batch_called"；
  - 若开启详情但所有条目因缺 ID 或搜索为空而未调用，则显示 "not_called"，并附加 "跳过原因": "no_items" 或 "missing_note_id" 或 "search_failed(code=...)"。
- 请求信息：
  - 每次失败返回需包含 path/url/环境/params（Token 打码）/http_status/duration_ms，便于定位错误。

数据展开与时间映射（强化要求）
- ads 模型兼容：统一展开 ads.note 或 item.note 为“真实笔记对象”，再进行字段提取，避免误取顶层导致 ID/标题为空。
- 发布时间统一：优先用 note.timestamp（秒级）；若无则用 note.update_time（毫秒级转秒）。输出统一为秒。

模式二  按笔记采集评论（优先调用Note Comments(V4)失败则调用Note Comments(V2)，入参只包含 token 和noteid，v2 多余的可选字段写个注释告诉编码者就行不有实际使用）
  - 一级评论：GET /get-note-comment/v4?token=&noteId=&sort=normal
  - 二级回复：GET /get-note-sub-comment/v2?token=&commentId=&noteId=...
1.功能说明
-  根据笔记链接采集评论数据
-  支持是否采集评论回复
2.输入项
- 笔记链接or笔记id：必填
- 是否采集二级评论：默认关闭
- 采集模式
  - 下拉框
  - 枚举值：默认、最新、最多点赞
3.输出项
- 昵称
- 评论内容
- 点赞数
- 发布时间
- 发布地点
- 评论级别（根评论or二级评论）
- 用户昵称
- 小红书号
- 作者ID
- 是否官方认证
4，接口说明：
Note Comments(V4)
GET
/api/xiaohongshu/get-note-comment/v4
Xiaohongshu Note Comment V4 API 小红书笔记评论V4接口
This API retrieves top-level comments under a specific Xiaohongshu note, including commenter information, comment content, like count, and timestamp.
Pagination is not supported; only the first page of comments is returned.
该接口用于获取指定小红书笔记下的一级评论数据，包括评论用户信息、评论内容、点赞数与评论时间等。
当前接口不支持翻页，仅返回第一页评论数据。
Request
Query Params
token
string 
required
TOKEN
noteId
string 
required
Note ID

Note Comments(V2)
GET
/api/xiaohongshu/get-note-comment/v2
Xiaohongshu Note Comment V2 API 小红书笔记评论V2接口
This API retrieves top-level comments under a specific Xiaohongshu note, including commenter information, comment content, like count, and timestamp.
该接口用于获取指定小红书笔记下的一级评论数据，包括评论用户信息、评论内容、点赞数与评论时间等。
Request
Query Params
token
string 
required
TOKEN
noteId
string 
required
Note ID
lastCursor
string 
optional
Previous page data's last comment ID
sort
string 
optional
Sort
normal :Normal
latest :Latest
Example:
latest
模式三  按用户信息采集笔记
1.功能说明
- 根据用户 UID 采集该用户的所有笔记
- 支持类型筛选与排序
2.输入项
- 用户 UID：必填
3.输出项
- 笔记字段
  - 用户昵称
  - 笔记ID
  - 笔记链接（https://www.xiaohongshu.com/explore/<note_id>）
  - 笔记标题
  - 笔记正文
  - 点赞数
  - 评论数
  - 收藏数
  - 好看数（仅视频笔记）
  - 分享次数
  - 笔记图片链接
  - 浏览数
  - 发布时间
  - 是否是商品笔记
  - 笔记类型

实现方案一：先调用 userdatanotelistv2
- 用户昵称 → data.notes[].user.nickname
- 笔记ID → data.notes[].id
- 笔记标题 → 优先 data.notes[].display_title；如为空可回退 data.notes[].title
- 笔记正文 → data.notes[].desc（调用 Note Detail v7获取）
- 点赞数 → data.notes[].likes
- 评论数 → data.notes[].comments_count
- 收藏数 → data.notes[].collected_count
- 好看数（仅视频笔记） → data.notes[].nice_count（通常视频类笔记才有）
- 分享次数 → data.notes[].share_count
- 笔记图片链接：
- 图文笔记：data.notes[].images_list[].url（或 url_size_large）
- 视频笔记：data.notes[].video_info_v2.image.first_frame（封面首帧），也可用 images_list[0].url 作为封面
- 浏览数 → data.notes[].view_count
- 发布时间 → data.notes[].create_time（秒级 Unix 时间戳）；同时有 data.notes[].time_desc（人类可读的时间描述）
- 是否是商品笔记 → data.notes[].is_goods_note（true/false）
- 笔记类型 → data.notes[].type（如 "video"、"image"）

实现方案 2：
如果 userdatanotelistv2 接口返回错误码，调用 userdatanotelistv4获取详细信息。
- 用户昵称：notes[].user.nickname
- 笔记ID：notes[].id
- 笔记标题：notes[].display_title（有些版本也会有 title，但以 display_title 为准）
- 笔记正文：notes[].desc（用 Note Detail v7 ）
- 点赞数：notes[].likes
- 评论数：notes[].comments_count
- 收藏数：notes[].collected_count
- 好看数（仅视频笔记）：notes[].nice_count（通常仅 type=video 才有）
- 分享次数：notes[].share_count
- 笔记图片链接：
- 图文笔记：notes[].images_list[].url（也可用 url_size_large 取大图）
- 视频笔记：notes[].video_info_v2.image.thumbnail 或 notes[].video_info_v2.image.first_frame（优先 thumbnail，first_frame是首帧）
- 同时视频也可能还带 images_list（作为预览），但以 video_info_v2.image 为主更稳定
- 浏览数：notes[].view_count（可能为0或不可靠，取决于平台侧是否开放）
- 发布时间：notes[].create_time（秒级 Unix 时间戳），人类可读可用 notes[].time_desc
- 是否是商品笔记：notes[].is_goods_note（布尔）
- 笔记类型：notes[].type（如 video、image 等）

其中笔记正文的部分：
完整正文，路径是 data[].note_list[].desc（样例： data[0].note_list[0].desc）
- 其他地方的 desc 或 content（如 share_info.content、mini_program_info.desc、qq_mini_program_info.desc）都是“分享摘要/推广文案”，经常被截断，不能当作正文。
- 所以以后提取正文时，优先且只使用 note_list[].desc；其他同名/相似字段一律忽略。
- 遍历 data[ ].note_list[ ]，优先取 type 为 "normal" 或 "video" 的条目里的 desc（一般只有一个；如果有多个，取最长的那一个）。
- 如果 desc 为空（比如纯视频没文案），可以选择降级用 share_info.content（但标记为“摘要”），或返回空。





